(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.GamepadMicro = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
function GamepadMicro(){this._buttonNames=["actionSouth","actionEast","actionWest","actionNorth","leftBumper","rightBumper","leftTrigger","rightTrigger","select","start","leftStick","rightStick","dPadUp","dPadDown","dPadLeft","dPadRight","extra"],this.reset()}function _newGamepad(){return{leftStick:{x:0,y:0},rightStick:{x:0,y:0},dPad:{x:0,y:0},buttons:{},_pressed:{},timestamp:0}}function _getRawGamepads(){var t=navigator.getGamepads&&navigator.getGamepads()||navigator.webkitGetGamepads&&navigator.webkitGetGamepads(),e=[];if(t)for(var a=0,i=t.length;i>a;a++){var n=t[a];n&&"standard"===n.mapping&&e.push(n)}return e}function _buttonPressed(t,e){if(!t||!t.buttons||e>=t.buttons.length)return!1;var a,i=t.buttons[e];return i?(a=i,"object"==typeof i&&(a=i.value),1===a):!1}function _gamepadSupported(){return navigator.getGamepads||!!navigator.webkitGetGamepads||!!navigator.webkitGamepads}GamepadMicro.prototype.reset=function(){this._ticking=!1,this._prevTimestamps=[],this._connectionListening=!1,this._updateCallback=function(){},this._prevRawGamepadTypes=[],this._prevPressedButtonsByGamepad=[],this.gamepadconnected=_getRawGamepads.length>0,this.gamepadConnected=!!this.gamepadconnected,this.gamepadSupported=!!_gamepadSupported(),this.gamepads=[],this._counter=0,this._heldButtonDelay=10,this._checkForHeld=!1},GamepadMicro.prototype.onUpdate=function(t){this._updateCallback=t,this._checkForEvents(),this._setupPoll()},GamepadMicro.prototype.offUpdate=function(){this._shouldRemoveEvents(),this._removePoll()},GamepadMicro.prototype.update=function(){this._updateCallback(this.gamepads)},GamepadMicro.prototype._checkForEvents=function(){this._connectionListening||(window.addEventListener("gamepadconnected",this._onGamepadConnected.bind(this),!1),window.addEventListener("gamepaddisconnected",this._onGamepadDisconnected.bind(this),!1),this._connectionListening=!0)},GamepadMicro.prototype._shouldRemoveEvents=function(){this._connectionListening&&(window.removeEventListener("gamepadconnected",this._onGamepadConnected.bind(this)),window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnected.bind(this)),this._connectionListening=!1)},GamepadMicro.prototype._onGamepadConnected=function(t){var e=t.gamepad;"standard"===e.mapping&&(this.gamepads[e.index]=_newGamepad(),this.gamepadconnected=!0,this.update())},GamepadMicro.prototype._onGamepadDisconnected=function(t){var e=t.gamepad,a=this.gamepads;a.forEach(function(t,i,n){i===e.index&&a.splice(i,1)}),a.length||(this.gamepadconnected=!1),this.update()},GamepadMicro.prototype._checkForGamepadChange=function(){for(var t=_getRawGamepads(),e=!1,a={},i=0,n=0;n<t.length;n++){var o=t[n];i=o.index,o.timestamp&&o.timestamp===this._prevTimestamps[i]||(this._prevTimestamps[i]=o.timestamp,a[i]=o,e=!0)}return e?a:!1},GamepadMicro.prototype._poll=function(){var t=this._checkForGamepadChange();if(t){this.gamepadconnected=!0,this.gamepadConnected=!0,this.gamepadSupported=!0;var e=!1,a=this.gamepads,i=this._buttonNames;Object.keys(t).map(function(n){var o=t[n];if(o){typeof o!=this._prevRawGamepadTypes[n]&&(e=!0,this._prevRawGamepadTypes[n]=typeof r);for(var s=[],d=this._prevPressedButtonsByGamepad[n]||{},p={},r=a[n]||_newGamepad(),c=0,m=i.length;m>c;c++){var h=i[c],u=!!r._pressed[h],g=r._pressed[h]=_buttonPressed(o,c);u&&!g?p[h]={pressed:!0}:g&&(s[h]=!0)}if(this._checkForHeld)for(var _ in s)if(s.hasOwnProperty(_)){var v=d[_];if(!v)continue;p[_]={held:!0}}this._prevPressedButtonsByGamepad[n]=s,r.timestamp=o.timestamp,r.buttons=p,r.leftStick.x=o.axes[0],r.leftStick.y=o.axes[1],r.rightStick.x=o.axes[2],r.rightStick.y=o.axes[3],r.dPad.x=(r.buttons.dPadLeft?-1:0)+(r.buttons.dPadRight?1:0),r.dPad.y=(r.buttons.dPadUp?-1:0)+(r.buttons.dPadDown?1:0),this.gamepads[n]=r}}.bind(this)),this.update()}},GamepadMicro.prototype._setupPoll=function(){this._ticking||(this._ticking=!0,this._tick())},GamepadMicro.prototype._tick=function(){var t=GamepadMicro.prototype._tick.bind(this),e=this._counter%this._heldButtonDelay===0;this.gamepadconnected&&e&&(this._checkForHeld=!0),this._poll(),this._counter++,this._checkForHeld=!1,this._ticking&&(window.requestAnimationFrame?window.requestAnimationFrame(t):window.mozRequestAnimationFrame?window.mozRequestAnimationFrame(t):window.webkitRequestAnimationFrame&&window.webkitRequestAnimationFrame(t))},GamepadMicro.prototype._removePoll=function(){this._ticking=!1},module.exports=GamepadMicro;
},{}]},{},[1])(1)
});